<!DOCTYPE html>
<html lang="zh-CN" data-theme="system">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 文档中心</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5/github-markdown.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@4/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/lib/core.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/github.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    <style>
        :root {
            /* 基础颜色变量 */
            --primary-color: #0067c0;
            --sidebar-width: 280px;
            --header-height: 48px;
            --transition-speed: 0.3s;
            --border-radius: 8px;
            
            /* 浅色主题 */
            --bg-color: #ffffff;
            --sidebar-bg: #f6f6f6;
            --text-color: #242424;
            --border-color: #e0e0e0;
            --hover-bg: #f0f0f0;
            --active-bg: #e5f1fb;
            --card-bg: #f9f9f9;
            
            /* 加载动画颜色 */
            --loading-color: var(--primary-color);
        }

        /* 深色主题 */
        [data-theme="dark"] {
            --bg-color: #1e1e1e;
            --sidebar-bg: #252525;
            --text-color: #f0f0f0;
            --border-color: #444;
            --hover-bg: #333;
            --active-bg: #2d2d2d;
            --card-bg: #2a2a2a;
            --loading-color: #60a5fa;
        }

        /* 蓝色主题 */
        [data-theme="blue"] {
            --primary-color: #1a73e8;
            --bg-color: #f8fafc;
            --sidebar-bg: #e8f0fe;
            --text-color: #202124;
            --border-color: #dadce0;
            --hover-bg: #e2eaf3;
            --active-bg: #d2e3fc;
            --card-bg: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* 侧边栏样式 - Win11风格 */
        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            position: fixed;
            z-index: 100;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header .logo {
            width: 32px;
            height: 32px;
            background-color: var(--primary-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .sidebar-header .title {
            font-size: 16px;
            font-weight: 600;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .nav-section {
            margin-bottom: 16px;
        }

        .nav-section-title {
            padding: 8px 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-color);
            opacity: 0.7;
        }

        .nav-item {
            position: relative;
            padding: 8px 20px;
            margin: 0 8px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            user-select: none;
        }

        .nav-item:hover {
            background-color: var(--hover-bg);
        }

        .nav-item.active {
            background-color: var(--active-bg);
            font-weight: 500;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: var(--primary-color);
            border-radius: 0 3px 3px 0;
            animation: expandBar var(--transition-speed) ease-out;
        }

        .nav-item .icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-item .label {
            flex: 1;
        }

        /* 内容区域 */
        #content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: margin-left var(--transition-speed);
        }

        #main-content {
            flex: 1;
            padding: 24px 40px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        /* 加载动画 */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 5px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--loading-color);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 18px;
            color: var(--text-color);
            margin-bottom: 16px;
        }

        .hitokoto {
            font-style: italic;
            color: var(--text-color);
            opacity: 0.7;
            max-width: 80%;
            text-align: center;
        }

        /* 主题切换按钮 */
        .theme-switcher {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 10;
            border: 1px solid var(--border-color);
        }

        /* Markdown内容样式 */
        .markdown-body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .markdown-body pre {
            background-color: var(--card-bg) !important;
            border-radius: var(--border-radius);
        }

        /* 动画 */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes expandBar {
            from { height: 0; }
            to { height: 100%; }
        }

        @keyframes slideIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            :root {
                --sidebar-width: 72px;
            }

            .sidebar-header .title,
            .nav-item .label,
            .nav-section-title {
                display: none;
            }

            .sidebar-header {
                justify-content: center;
                padding: 16px 0;
            }

            .nav-item {
                justify-content: center;
                margin: 0;
                padding: 12px 0;
            }
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading-container" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">正在加载文档...</div>
        <div class="hitokoto" id="hitokoto"></div>
    </div>

    <!-- 侧边栏 -->
    <div id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="ti ti-book"></i>
            </div>
            <div class="title">API 文档中心</div>
        </div>

        <div class="sidebar-nav" id="directoryTree">
            <!-- 这里将通过JS动态生成目录 -->
        </div>
    </div>

    <!-- 主内容区 -->
    <div id="content">
        <main id="main-content" class="markdown-body"></main>
    </div>

    <!-- 主题切换按钮 -->
    <div class="theme-switcher" id="themeSwitcher">
        <i class="ti ti-brightness-up" id="themeIcon"></i>
    </div>

    <script>
        // 配置 marked
        marked.setOptions({
            highlight: function(code, lang) {
                if (hljs.getLanguage(lang)) {
                    return hljs.highlight(lang, code).value;
                }
                return hljs.highlightAuto(code).value;
            },
            langPrefix: 'hljs language-',
            gfm: true,
            breaks: true
        });

        // 状态管理
        const state = {
            currentFile: null,
            directoryStructure: null,
            theme: localStorage.getItem('theme') || 'system',
            collapsedGroups: JSON.parse(localStorage.getItem('collapsedGroups')) || {}
        };

        // DOM 元素
        const loadingScreen = document.getElementById('loadingScreen');
        const sidebar = document.getElementById('sidebar');
        const content = document.getElementById('content');
        const directoryTree = document.getElementById('directoryTree');
        const mainContent = document.getElementById('main-content');
        const themeSwitcher = document.getElementById('themeSwitcher');
        const themeIcon = document.getElementById('themeIcon');
        const hitokotoElement = document.getElementById('hitokoto');

        // 初始化
        document.addEventListener('DOMContentLoaded', async () => {
            // 设置初始主题
            applyTheme(state.theme);
            
            // 获取一言
            fetchHitokoto();
            
            // 加载目录结构
            await loadDirectoryTree();
            
            // 设置事件监听器
            setupEventListeners();
            
            // 根据 URL 参数加载文件
            loadFileFromUrl();
            
            // 隐藏加载动画
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                loadingScreen.style.visibility = 'hidden';
            }, 500);
        });

        // 获取一言
        async function fetchHitokoto() {
            try {
                const response = await fetch('https://v1.hitokoto.cn/');
                const data = await response.json();
                hitokotoElement.textContent = `"${data.hitokoto}" —— ${data.from}`;
            } catch (error) {
                hitokotoElement.textContent = '"学而不思则罔，思而不学则殆。" —— 孔子';
            }
        }

        // 加载目录树
        async function loadDirectoryTree() {
            try {
                const response = await fetch('DIRECTORY_TREE.md');
                if (!response.ok) throw new Error('无法加载目录树');
                
                const text = await response.text();
                state.directoryStructure = parseDirectoryTree(text);
                renderDirectoryTree();
            } catch (error) {
                console.error('加载目录树失败:', error);
                directoryTree.innerHTML = `<div style="padding: 15px; color: red;">加载目录树失败: ${error.message}</div>`;
            }
        }

        // 解析目录树
        function parseDirectoryTree(text) {
            const lines = text.split('\n');
            const structure = [];
            let currentGroup = null;
            
            for (const line of lines) {
                if (line.startsWith('# ')) {
                    // 目录组
                    const groupName = line.substring(2).trim();
                    currentGroup = {
                        name: groupName,
                        files: []
                    };
                    structure.push(currentGroup);
                } else if (line.startsWith('- [')) {
                    // 文件项
                    if (!currentGroup) {
                        currentGroup = { name: '未分类', files: [] };
                        structure.push(currentGroup);
                    }
                    
                    const match = line.match(/^- \[(.+?)\]\((.+?)\)/);
                    if (match) {
                        currentGroup.files.push({
                            name: match[1],
                            path: match[2]
                        });
                    }
                }
            }
            
            return structure;
        }

        // 渲染目录树
        function renderDirectoryTree() {
            if (!state.directoryStructure) return;
            
            let html = '';
            
            // 首页导航项
            html += `
                <div class="nav-section">
                    <div class="nav-item ${!state.currentFile ? 'active' : ''}" data-path="content/index.md">
                        <div class="icon"><i class="ti ti-home"></i></div>
                        <div class="label">首页</div>
                    </div>
                </div>
            `;
            
            // 文档目录
            state.directoryStructure.forEach(group => {
                html += `
                    <div class="nav-section">
                        <div class="nav-section-title">${group.name}</div>
                `;
                
                group.files.forEach(file => {
                    html += `
                        <div class="nav-item ${state.currentFile === file.path ? 'active' : ''}" 
                             data-path="${file.path}">
                            <div class="icon"><i class="ti ti-file-text"></i></div>
                            <div class="label">${file.name.replace('.md', '')}</div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });
            
            directoryTree.innerHTML = html;
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 导航项点击
            directoryTree.addEventListener('click', e => {
                const item = e.target.closest('.nav-item');
                if (item) {
                    const filePath = item.dataset.path;
                    loadFile(filePath);
                    updateActiveItem(filePath);
                    updateUrl(filePath);
                }
            });
            
            // 主题切换
            themeSwitcher.addEventListener('click', toggleTheme);
            
            // 响应式设计 - 小屏幕自动调整
            window.addEventListener('resize', handleResize);
            handleResize();
        }

        // 加载文件
        async function loadFile(filePath) {
            if (!filePath) {
                filePath = 'content/index.md';
                updateUrl(filePath);
            }
            
            // 显示加载状态
            mainContent.style.opacity = '0';
            
            try {
                const response = await fetch(filePath);
                if (!response.ok) throw new Error('文件加载失败');
                
                const markdown = await response.text();
                
                // 添加淡入动画
                setTimeout(() => {
                    mainContent.innerHTML = marked.parse(markdown);
                    mainContent.style.opacity = '1';
                    mainContent.style.animation = 'fadeIn 0.3s ease-out';
                }, 150);
                
                state.currentFile = filePath;
            } catch (error) {
                console.error('加载文件失败:', error);
                mainContent.innerHTML = `
                    <div style="color: red;">
                        <h2>加载文件失败</h2>
                        <p>${error.message}</p>
                        <p>文件路径: ${filePath}</p>
                    </div>
                `;
                mainContent.style.opacity = '1';
            }
        }

        // 更新活动项
        function updateActiveItem(filePath) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.path === filePath);
            });
        }

        // 从 URL 加载文件
        function loadFileFromUrl() {
            const params = new URLSearchParams(window.location.search);
            const fileParam = params.get('file');
            
            if (fileParam) {
                // 确保路径以 content/ 开头
                let filePath = fileParam.startsWith('content/') ? fileParam : `content/${fileParam}`;
                // 确保有 .md 后缀
                if (!filePath.endsWith('.md')) filePath += '.md';
                
                loadFile(filePath);
            } else {
                loadFile('content/index.md');
            }
        }

        // 更新 URL
        function updateUrl(filePath) {
            // 从路径中移除 content/ 前缀和 .md 后缀
            let displayPath = filePath.replace(/^content\//, '').replace(/\.md$/, '');
            
            const newUrl = `${window.location.pathname}?file=${encodeURIComponent(displayPath)}`;
            window.history.pushState({ path: newUrl }, '', newUrl);
        }

        // 主题功能
        function applyTheme(theme) {
            state.theme = theme;
            localStorage.setItem('theme', theme);
            
            // 处理系统主题偏好
            if (theme === 'system') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            
            // 更新主题图标
            updateThemeIcon();
        }

        function toggleTheme() {
            const themes = ['system', 'light', 'dark', 'blue'];
            const currentIndex = themes.indexOf(state.theme);
            const nextIndex = (currentIndex + 1) % themes.length;
            applyTheme(themes[nextIndex]);
        }

        function updateThemeIcon() {
            const theme = document.documentElement.getAttribute('data-theme');
            switch(theme) {
                case 'dark':
                    themeIcon.className = 'ti ti-moon';
                    break;
                case 'blue':
                    themeIcon.className = 'ti ti-brand-react';
                    break;
                default:
                    themeIcon.className = 'ti ti-sun';
            }
        }

        // 响应式处理
        function handleResize() {
            if (window.innerWidth < 768) {
                document.documentElement.style.setProperty('--sidebar-width', '72px');
            } else {
                document.documentElement.style.setProperty('--sidebar-width', '280px');
            }
        }

        // 处理浏览器前进/后退
        window.addEventListener('popstate', () => {
            loadFileFromUrl();
        });

        // 监听系统主题变化
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (state.theme === 'system') {
                applyTheme('system');
            }
        });
    </script>
</body>
</html>
